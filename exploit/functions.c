/*
 * This file is part of PRO CFW.

 * PRO CFW is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.

 * PRO CFW is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with PRO CFW. If not, see <http://www.gnu.org/licenses/ .
 */

#include <stdio.h>
#include <pspsdk.h>
#include <pspiofilemgr.h>
#include <psploadexec.h>
#include <psploadexec_kernel.h>
#include <psputility_modules.h>
#include <pspumd.h>
#include <module2.h>
#include <lflash0.h>
#include <macros.h>
#include <rebootconfig.h>
#include <systemctrl_se.h>
#include "offsets.h"
#include "functions.h"

/*
 * These Mappings are Syscall Mappings! Don't bother trying them inside
 * of a Kernel Permission Context! You will crash!
 */

/*
 * These functions are ment for using when initial kernel access has been
 * granted, for example through the mean of a kernel exploit.
 */

// iofilemgr.prx Functions
int (* KernelIOOpen)(char *, int, int) = NULL;
int (* KernelIOWrite)(int, void *, unsigned) = NULL;
int (* KernelIORead)(int, void *, unsigned) = NULL;
int (* KernelIOClose)(int) = NULL;
int (* KernelIODopen)(char *) = NULL;
int (* KernelIODread)(int, SceIoDirent *) = NULL;
int (* KernelIODclose)(int) = NULL;

// sysmem.prx Functions
void (* _sceKernelIcacheInvalidateAll)(void) = (void *)(SYSMEM_TEXT + SYSMEM_ICACHE_INVALIDATE_ALL);
void (* _sceKernelDcacheWritebackInvalidateAll)(void) = (void *)(SYSMEM_TEXT + SYSMEM_DCACHE_WRITEBACK_INVALIDATE_ALL);
int (* _sceKernelGzipDecompress)(unsigned char *dest, unsigned int destSize, const unsigned char *src, void *unknown) = (void *)(SYSMEM_TEXT + SYSMEM_GZIP_DECOMPRESS);
void (* _sceKernelDcacheInvalidateRange)(const void *p, unsigned int size) = (void *)(SYSMEM_TEXT + SYSMEM_DCACHE_WRITEBACK_INVALIDATE_RANGE);

// loadcore.prx Functions
SceModule2 * (* _sceKernelFindModuleByName)(char *) = (void *)(LOADCORE_TEXT + LOADCORE_FIND_MODULE_BY_NAME);

// threadman.prx Functions
SceUID (* _sceKernelCreateThread)(const char *name, SceKernelThreadEntry entry,\
		int initPriority, int stackSize, SceUInt attr, SceKernelThreadOptParam *option);
int (* _sceKernelStartThread)(SceUID thid, SceSize arglen, void *argp);

int (* _sceKermit_driver_4F75AA05)(KermitPacket *packet, u32 cmd_mode, u32 cmd, u32 argc, u32 allow_callback, u64 *resp) = NULL;

/*
 * This file is part of PRO CFW.

 * PRO CFW is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.

 * PRO CFW is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with PRO CFW. If not, see <http://www.gnu.org/licenses/ .
 */

#ifndef _KXPLOIT_H_
#define _KXPLOIT_H_

// Target define
#define CERT_LIBC_TIME_JALR_NOP 0
#define CERT_SYSMEMUSERFORUSER_91DE343C 1
#define CERT_LIBC_TIME 2

// Vulnearable define
#define LOAD_CERT_FROM_FLASH 0
#define WLAN_GET_ETHER_ADDR 1
#define WLANDRV_LIB 2
#define SD_GET_LAST_INDEX 3

#if KXPLOIT == WLAN_GET_ETHER_ADDR

#undef KXPLOIT_TARGET
#define KXPLOIT_TARGET CERT_LIBC_TIME
#define KXPLOIT_TARGET_CHOICE CERT_LIBC_TIME

#elif KXPLOIT == WLANDRV_LIB
#define KXPLOIT_TARGET_CHOICE CERT_LIBC_TIME

#elif KXPLOIT == SD_GET_LAST_INDEX
#undef KXPLOIT_TARGET
#define KXPLOIT_TARGET CERT_LIBC_TIME
#define KXPLOIT_TARGET_CHOICE CERT_LIBC_TIME

#else
#define KXPLOIT_TARGET_CHOICE CERT_LIBC_TIME_JALR_NOP
#endif

#ifndef KXPLOIT_TARGET
#define KXPLOIT_TARGET CERT_LIBC_TIME_JALR_NOP

#endif

#ifndef GAME_KERNEL_LIBC_TIME

#ifdef GAME_SYSMEMUSERFORUSER_91DE343C
#undef KXPLOIT_TARGET_CHOICE
#define KXPLOIT_TARGET_CHOICE CERT_SYSMEMUSERFORUSER_91DE343C
#endif

#elif KXPLOIT_TARGET == CERT_SYSMEMUSERFORUSER_91DE343C

#ifdef GAME_SYSMEMUSERFORUSER_91DE343C
#undef KXPLOIT_TARGET_CHOICE
#define KXPLOIT_TARGET_CHOICE CERT_SYSMEMUSERFORUSER_91DE343C
#endif

#endif

#if KXPLOIT_TARGET_CHOICE == CERT_LIBC_TIME_JALR_NOP
#define KXPLOIT_TARGET_INSTR_ADDR SYSMEM_LIBC_TIME_JALR_NOP
#elif KXPLOIT_TARGET_CHOICE == CERT_SYSMEMUSERFORUSER_91DE343C

#define KXPLOIT_TARGET_INSTR_ADDR SYSMEM_SYSMEMUSERFORUSER_91DE343C_NOP
#define CERT_VRAM_JUMP_ADDRESS 0x04100000	// jump to vram with kernel rights
// align 4 for valid j instruction, but j instr must be a 4 aligned addr too so this means we must keep this address 16 aligned

#elif KXPLOIT_TARGET_CHOICE == CERT_LIBC_TIME
#define KXPLOIT_TARGET_INSTR_ADDR SYSMEM_LIBC_TIME

#endif

#define SCE_ERROR_OUT_OF_MEMORY   0x80000022

void kernelContentFunction(void);
int stubScanner(void);
int doExploit(void);
void executeKernel(void);

#endif
